<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student â€¢ Attendance</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Inline fallback styles: keep this minimal and page-scoped so attendance shows even if styles.css fails to load -->
    <style id="attendance-fallback-styles">
        /* Basic layout */
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap: 1rem; }
        .info-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 0.75rem; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
        .info-card h4{ margin-bottom:0.5rem; font-size:0.95rem }
        .key-value { display:flex; flex-direction:column; gap:0.25rem; }
        .key{ color:#6b7280; font-size:0.85rem }
        .val{ font-weight:700 }
        .data-table{ width:100%; border-collapse:collapse; background:#fff; border:1px solid #e5e7eb; border-radius:6px; overflow:hidden }
        .data-table th, .data-table td{ padding:0.55rem 0.75rem; text-align:left; border-bottom:1px solid #f3f4f6; font-size:0.95rem }
        .data-table thead th{ background:#f9fafb; font-weight:700 }
        .badge{ display:inline-flex; align-items:center; padding:0.18rem 0.5rem; border-radius:999px; font-weight:600; font-size:0.82rem }
        .badge-green{ background:#dcfce7; color:#166534; border:1px solid #bbf7d0 }
        .badge-yellow{ background:#fef3c7; color:#92400e; border:1px solid #fde68a }
        .badge-red{ background:#fee2e2; color:#b91c1c; border:1px solid #fecaca }
        /* header and main spacing guard */
        .header{ position:fixed; top:0; left:0; right:0; min-height:64px; background:linear-gradient(135deg,#2563eb,#1d4ed8); color:white; display:flex; align-items:center; padding:0 1rem; z-index:1000 }
        .main-content{ padding-top:calc(var(--header-height,80px) + 1rem); padding-left:1rem; padding-right:1rem }
        /* ensure debug box readable */
        #attDebug{ background: rgba(255,255,255,0.9); border:1px solid #e6e6e6; padding:0.5rem; font-family:monospace; white-space:pre-wrap; border-radius:6px }
        /* Module header and container */
        .module { background: transparent; margin-bottom:1rem }
        .module-header h2 { font-size:1.15rem; margin-bottom:0.75rem; color:#111827 }
        .table-container{ background:transparent; border-radius:6px; overflow:hidden }
        .data-table tr:hover td{ background:#fbfbfc }
        .data-table tr:nth-child(odd) td{ background:#ffffff }
        .data-table tr:nth-child(even) td{ background:#fbfbfd }
        .muted{ color:#6b7280; font-style:italic }
        /* status badges more visible */
        .badge { box-shadow: 0 1px 0 rgba(0,0,0,0.02); }
        /* small responsive tweaks */
        @media (max-width:720px){ .data-table th, .data-table td{ font-size:0.88rem; padding:0.45rem 0.5rem } }
    </style>
</head>
<body class="user-student">
    <div class="container">
        <header class="header">
            <div class="logo"><img src="assets/astra_logo.png" alt="Astra" style="height:40px;transform:scale(2.35);"></div>
            <nav class="header-nav">
                <ul class="nav-menu">
                    <li class="nav-item" data-navigate="page" data-target-url="student.html"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></li>
                    <li class="nav-item" data-navigate="page" data-target-url="student_courses.html"><i class="fas fa-book"></i><span>My Courses</span></li>
                    <li class="nav-item" data-navigate="page" data-target-url="student_grades.html"><i class="fas fa-chart-line"></i><span>Grades</span></li>
                    <li class="nav-item active" data-navigate="page" data-target-url="student_attendance.html"><i class="fas fa-calendar-check"></i><span>Attendance</span></li>
                    <li class="nav-item" data-navigate="page" data-target-url="student_assignments.html"><i class="fas fa-clipboard-list"></i><span>Assignments</span></li>
                    <li class="nav-item" data-navigate="page" data-target-url="student_schedule.html"><i class="fas fa-calendar-alt"></i><span>Schedule</span></li>
                    <li class="nav-item" data-navigate="page" data-target-url="student_lms.html"><i class="fas fa-laptop-code"></i><span>LMS</span></li>
                </ul>
            </nav>
            <div class="header-user-controls"><div class="header-actions">
                <button class="header-btn notification-btn" title="Notifications"><i class="fas fa-bell"></i><span class="notification-badge">2</span></button>
                <button class="header-btn profile-btn" title="Profile" onclick="openProfileMenu()"><i class="fas fa-user-graduate"></i></button>
                <button class="header-btn logout-btn" onclick="logout()" title="Logout" id="logoutButton"><i class="fas fa-sign-out-alt"></i><span class="btn-text">Logout</span></button>
            </div></div>
        </header>
        <footer class="footer"><div class="footer-content"><div class="footer-section"><h3>Student Portal</h3><p>Your gateway to academic success</p></div></div></footer>
    </div>
    <script src="script.js"></script>
    <script>
        document.querySelectorAll('.nav-item').forEach(function(item){
            item.addEventListener('click', function(){
                var url = this.getAttribute('data-target-url');
                if(url){ window.location.href = url; }
            });
        });
    </script>
    <script>
        // Lightweight diagnostic info to help debug why attendance may not render
        (function(){
            try {
                var dbg = document.getElementById('attDebug');
                if(!dbg) return;
                // gather data after a timeout to allow script.js to initialize
                setTimeout(function(){
                    var user = null;
                    try { user = JSON.parse(localStorage.getItem('erp_user_data')||'null'); } catch(e){}
                    var studs = [];
                    try { studs = JSON.parse(localStorage.getItem('erp_students')||'[]'); } catch(e){}
                    var ats = [];
                    try { ats = JSON.parse(localStorage.getItem('erp_attendance')||'[]'); } catch(e){}
                    var lines = [];
                    lines.push('students count: '+(Array.isArray(studs)?studs.length:0));
                    lines.push('attendance count: '+(Array.isArray(ats)?ats.length:0));
                    lines.push('local user: '+(user? (user.userType+' '+(user.studentId||user.email||'') ) : 'none'));
                    // Attempt to resolve fallback student
                    var fallback = (Array.isArray(studs)&&studs.length>0) ? studs[0] : null;
                    lines.push('fallback student id: '+ (fallback? (fallback.studentId||fallback.rollNo||'-') : 'none'));
                    dbg.textContent = lines.join('\n');
                    dbg.style.display = 'block';
                }, 450);
            } catch(e) { console.error(e); }
        })();
    </script>
    <script>
        // Check whether styles.css is reachable and what computed styles are applied.
        (function(){
            try{
                var dbg = document.getElementById('attDebug');
                if(!dbg) return;
                // append results after existing lines
                setTimeout(function(){
                    // fetch styles.css to ensure the file is served
                    fetch('styles.css', {cache:'no-store'}).then(function(res){
                        dbg.textContent += '\nstyles.css fetch: '+res.status+' '+res.statusText;
                        return res.text();
                    }).catch(function(err){
                        dbg.textContent += '\nstyles.css fetch: ERROR ('+ (err && err.message) +')';
                    }).finally(function(){
                        try{
                            var bodyBg = window.getComputedStyle(document.body).backgroundColor;
                            dbg.textContent += '\ncomputed body background: '+ bodyBg;
                            var header = document.querySelector('.header');
                            if(header) dbg.textContent += '\ncomputed header background: '+ window.getComputedStyle(header).backgroundImage;
                        }catch(e){}
                    });
                },700);
            }catch(e){ console.error(e); }
        })();
    </script>
    <script>
        // Import attendance helper: populate localStorage from /data/erp_attendance.json
        (function(){
            var btn = document.getElementById('importAttBtn');
            var status = document.getElementById('importAttStatus');
            if (!btn) return;
            btn.addEventListener('click', function(){
                status.textContent = 'Importing...';
                fetch('/data/erp_attendance.json', { cache: 'no-store' }).then(function(res){
                    if (!res.ok) throw new Error('not-found');
                    return res.json();
                }).then(function(data){
                    if (!Array.isArray(data)) throw new Error('bad-format');
                    localStorage.setItem('erp_attendance', JSON.stringify(data));
                    status.textContent = 'Imported '+data.length+' records.';
                    // let script.js re-render attendance
                    try { renderStudentPortalSections(); } catch(e) {}
                }).catch(function(){
                    // fallback: if fetch fails, try to use simple embedded sample from the page (few records)
                    try {
                        var sample = [
                            { id: 'A1', studentId: 'ST001', status: 'present', date: '2025-09-25', time: '09:05' },
                            { id: 'A2', studentId: 'ST002', status: 'absent', date: '2025-09-25', time: '09:05' }
                        ];
                        localStorage.setItem('erp_attendance', JSON.stringify(sample));
                        status.textContent = 'Imported sample ('+sample.length+')';
                        try { renderStudentPortalSections(); } catch(e) {}
                    } catch(e) { status.textContent = 'Import failed'; }
                });
            });
        })();
    </script>
    <script>
        // Diagnostic: log header mutations and updateHeaderHeight calls to aid debugging layout shifts
        (function(){
            try {
                var header = document.querySelector('.header');
                if (!header) return;

                // Log initial state
                console.info('[hdr-dbg] initial header class=', header.className, ' style=', header.style.cssText);

                // Watch for clicks anywhere in document and log header state
                document.addEventListener('click', function(evt){
                    try {
                        console.info('[hdr-dbg] click at', evt.target && (evt.target.tagName + (evt.target.id?('#'+evt.target.id):''))), ' header.class=', header.className, ' header.style=', header.style.cssText;
                    } catch(e){ console.error('[hdr-dbg] click log error', e); }
                }, true);

                // Wrap updateHeaderHeight to log calls if present
                if (window.updateHeaderHeight && typeof window.updateHeaderHeight === 'function') {
                    var _origUpdate = window.updateHeaderHeight;
                    window.updateHeaderHeight = function(){
                        try { console.info('[hdr-dbg] updateHeaderHeight called - before class=', header.className, ' style=', header.style.cssText); } catch(e){}
                        var res = _origUpdate.apply(this, arguments);
                        try { console.info('[hdr-dbg] updateHeaderHeight returned - after class=', header.className, ' style=', header.style.cssText); } catch(e){}
                        return res;
                    };
                }

                // Observe attribute changes on header (class/style) using MutationObserver
                try {
                    var mo = new MutationObserver(function(mutations){
                        mutations.forEach(function(m){
                            if (m.type === 'attributes') {
                                console.info('[hdr-dbg] header attribute changed:', m.attributeName, ' class=', header.className, ' style=', header.style.cssText);
                            }
                        });
                    });
                    mo.observe(header, { attributes: true, attributeFilter: ['class', 'style'] });
                } catch(e) { console.error('[hdr-dbg] MutationObserver error', e); }

            } catch(e) { console.error('[hdr-dbg] init error', e); }
        })();
    </script>
</body>
</html>


